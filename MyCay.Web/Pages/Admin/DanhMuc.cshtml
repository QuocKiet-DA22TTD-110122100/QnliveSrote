@page
@model AdminDanhMucModel
@{
    ViewData["Title"] = "Qu·∫£n l√Ω danh m·ª•c";
    Layout = "_AdminLayout";
}

<div class="page-header">
    <h1 class="page-title">Qu·∫£n l√Ω danh m·ª•c</h1>
    <div class="page-actions">
        <button class="btn btn-primary" onclick="openAddModal()">
            <i class="fas fa-plus"></i> Th√™m danh m·ª•c
        </button>
    </div>
</div>

<!-- Categories Grid -->
<div class="categories-admin-grid" id="categoriesGrid">
    <!-- Categories will be loaded here -->
</div>

<!-- Category Modal -->
<div class="modal-overlay" id="categoryModal">
    <div class="modal">
        <div class="modal-header">
            <h3 id="modalTitle">Th√™m danh m·ª•c</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="categoryForm">
                <input type="hidden" id="categoryId" />
                <div class="form-group">
                    <label>T√™n danh m·ª•c *</label>
                    <input type="text" id="categoryName" required />
                </div>
                <div class="form-group">
                    <label>M√¥ t·∫£</label>
                    <textarea id="categoryDesc"></textarea>
                </div>
                <div class="form-group">
                    <label>Th·ª© t·ª± hi·ªÉn th·ªã</label>
                    <input type="number" id="categoryOrder" value="0" />
                </div>
                <div class="form-group">
                    <label>H√¨nh ·∫£nh</label>
                    <input type="text" id="categoryImage" placeholder="T√™n file ·∫£nh" />
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">H·ªßy</button>
            <button class="btn btn-primary" onclick="saveCategory()">L∆∞u</button>
        </div>
    </div>
</div>

<style>
.categories-admin-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}
.category-admin-card {
    background: var(--admin-white);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    transition: var(--transition);
}
.category-admin-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}
.category-image {
    height: 120px;
    background: linear-gradient(135deg, #f97316, #ea580c);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
}
.category-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.category-content {
    padding: 20px;
}
.category-content h3 {
    font-size: 1.1rem;
    margin-bottom: 5px;
}
.category-content p {
    color: var(--admin-gray);
    font-size: 0.9rem;
    margin-bottom: 15px;
}
.category-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid var(--admin-gray-light);
}
.category-count {
    font-size: 0.85rem;
    color: var(--admin-gray);
}
.category-actions {
    display: flex;
    gap: 8px;
}
</style>

@section Scripts {
<script>
const categories = [
    { id: 1, name: 'M√¨ Cay', desc: 'C√°c lo·∫°i m√¨ cay ƒë·∫∑c tr∆∞ng H√†n Qu·ªëc', image: 'MenuItemGroup_MG00005.webp', order: 1, products: 10, icon: 'üçú' },
    { id: 2, name: 'M√¨ T∆∞∆°ng ƒêen', desc: 'M√¨ tr·ªôn t∆∞∆°ng ƒëen H√†n Qu·ªëc', image: 'MenuItemGroup_MG00006.webp', order: 2, products: 4, icon: 'ü•¢' },
    { id: 3, name: 'M√¨ X√†o', desc: 'C√°c lo·∫°i m√¨ x√†o', image: null, order: 3, products: 3, icon: 'üçù' },
    { id: 4, name: 'M√≥n Kh√°c', desc: 'C∆°m, tokbokki v√† c√°c m√≥n kh√°c', image: 'MenuItemGroup_MG00007.webp', order: 4, products: 7, icon: 'üçö' },
    { id: 5, name: 'M√≥n Th√™m M√¨', desc: 'Topping th√™m cho m√¨', image: null, order: 5, products: 13, icon: 'ü•ö' },
    { id: 6, name: 'Combo', desc: 'C√°c combo ti·∫øt ki·ªám', image: 'MenuItemGroup_MG00003.webp', order: 6, products: 6, icon: 'üéÅ' },
    { id: 7, name: 'L·∫©u H√†n Qu·ªëc', desc: 'C√°c lo·∫°i l·∫©u H√†n Qu·ªëc', image: null, order: 7, products: 6, icon: 'üç≤' },
    { id: 8, name: 'M√≥n Th√™m L·∫©u', desc: 'Topping th√™m cho l·∫©u', image: null, order: 8, products: 17, icon: 'ü•¨' },
    { id: 9, name: 'Khai V·ªã', desc: 'M√≥n khai v·ªã, ƒÉn v·∫∑t', image: 'MenuItemGroup_MG00010.webp', order: 9, products: 17, icon: 'üçü' },
    { id: 10, name: 'Gi·∫£i Kh√°t', desc: 'ƒê·ªì u·ªëng, n∆∞·ªõc gi·∫£i kh√°t', image: 'MenuItemGroup_MG00018.webp', order: 10, products: 17, icon: 'ü•§' }
];

function renderCategories() {
    const grid = document.getElementById('categoriesGrid');
    grid.innerHTML = categories.map(c => `
        <div class="category-admin-card">
            <div class="category-image">
                ${c.image ? `<img src="/images/products/${c.image}" onerror="this.parentElement.innerHTML='${c.icon}'" />` : c.icon}
            </div>
            <div class="category-content">
                <h3>${c.name}</h3>
                <p>${c.desc || 'Ch∆∞a c√≥ m√¥ t·∫£'}</p>
                <div class="category-meta">
                    <span class="category-count"><i class="fas fa-utensils"></i> ${c.products} s·∫£n ph·∫©m</span>
                    <div class="category-actions">
                        <button class="action-btn edit" onclick="editCategory(${c.id})" title="S·ª≠a"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete" onclick="deleteCategory(${c.id})" title="X√≥a"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
}

function openAddModal() {
    document.getElementById('modalTitle').textContent = 'Th√™m danh m·ª•c';
    document.getElementById('categoryForm').reset();
    document.getElementById('categoryId').value = '';
    document.getElementById('categoryModal').classList.add('show');
}

function editCategory(id) {
    const cat = categories.find(c => c.id === id);
    if (!cat) return;
    
    document.getElementById('modalTitle').textContent = 'S·ª≠a danh m·ª•c';
    document.getElementById('categoryId').value = cat.id;
    document.getElementById('categoryName').value = cat.name;
    document.getElementById('categoryDesc').value = cat.desc || '';
    document.getElementById('categoryOrder').value = cat.order;
    document.getElementById('categoryImage').value = cat.image || '';
    
    document.getElementById('categoryModal').classList.add('show');
}

function closeModal() {
    document.getElementById('categoryModal').classList.remove('show');
}

function saveCategory() {
    const id = document.getElementById('categoryId').value;
    const data = {
        name: document.getElementById('categoryName').value,
        desc: document.getElementById('categoryDesc').value,
        order: parseInt(document.getElementById('categoryOrder').value) || 0,
        image: document.getElementById('categoryImage').value
    };
    
    if (!data.name) {
        showToast('Vui l√≤ng nh·∫≠p t√™n danh m·ª•c!', 'error');
        return;
    }
    
    if (id) {
        const index = categories.findIndex(c => c.id == id);
        if (index > -1) categories[index] = { ...categories[index], ...data };
        showToast('C·∫≠p nh·∫≠t th√†nh c√¥ng!', 'success');
    } else {
        data.id = categories.length + 1;
        data.products = 0;
        data.icon = 'üì¶';
        categories.push(data);
        showToast('Th√™m danh m·ª•c th√†nh c√¥ng!', 'success');
    }
    
    closeModal();
    renderCategories();
}

function deleteCategory(id) {
    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a danh m·ª•c n√†y?')) {
        const index = categories.findIndex(c => c.id === id);
        if (index > -1) categories.splice(index, 1);
        renderCategories();
        showToast('ƒê√£ x√≥a danh m·ª•c!', 'warning');
    }
}

function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = 'toast ' + type;
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

renderCategories();
</script>
}
